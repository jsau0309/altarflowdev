---
description: Apply these rules when creating the project
globs: 
alwaysApply: true
---
## Project Overview

*   **Type:** cursor_project_rules
*   **Description:** Altarflow is a sophisticated, bilingual church management platform tailored for Hispanic churches in the United States. It modernizes traditional church administration by integrating digital tools with conventional methods, enabling efficient donation tracking, expense management, and member relationship nurturing—ideal for users with varied technological proficiency.
*   **Primary Goal:** Modernize church management by implementing NFC-enabled donations with secure payment processing (via Stripe Connect), comprehensive expense and member management, and a bilingual interface (English/Spanish) to support digital transformation in church operations.

## Project Structure

### Framework-Specific Routing

*   **Directory Rules:**

    *   **Next.js 14 (App Router):** Enforce the use of the `app/` directory with nested route folders. For example, follow the `app/[route]/page.tsx` conventions.
    *   Example 1: "Next.js 14 (App Router)" → `app/[route]/page.tsx` conventions
    *   Example 2: "Next.js (Pages Router)" → `pages/[route].tsx` pattern
    *   Example 3: "React Router 6" → `src/routes/` with `createBrowserRouter`

### Core Directories

*   **Versioned Structure:**

    *   **app/api:** Next.js 14 API routes using Route Handlers
    *   **components/ui:** Contains shadcn UI components and other versioned frontend elements (e.g., Tailwind CSS components)
    *   Example 1: `app/api` → "Next.js 14 API routes with Route Handlers"
    *   Example 2: `src/views` → "Vue 3 composition API components (if applicable)"

### Key Files

*   **Stack-Versioned Patterns:**

    *   **app/dashboard/layout.tsx:** Next.js 14 root layout implementing nested routing and global providers
    *   **pages/_app.js:** Next.js Pages Router customization (not used in App Router projects)
    *   Example 1: `app/dashboard/layout.tsx` → "Next.js 14 root layouts"
    *   Example 2: `pages/_app.js` → "Next.js Pages Router customization"

## Tech Stack Rules

*   **Version Enforcement:**

    *   **next@14:** App Router is required; avoid using deprecated functions like `getInitialProps`
    *   **tailwindcss@3+:** Utilize JIT mode and purge unused styles for optimal performance
    *   **typescript:** Enforce strict typing and utilize modern features of TypeScript
    *   **supabase:** Implement secure API calls and use server-side functions for database operations
    *   **shadcn UI:** Follow component best practices for accessibility and theming
    *   **clerk auth:** Ensure secure role-based authentication and proper session management
    *   **stripe connect:** Adhere to secure payment processing protocols and handle both one-time and recurring payments
    *   **prisma:** Ensure efficient database management and querying with strong schema validations
    *   **react i18next:** Use best practices for manual language toggling between English and Spanish
    *   **twilio sms api:** Integrate SMS notifications with proper error handling and compliance

## PRD Compliance

*   **Non-Negotiable:**

    *   "Enable NFC-enabled donation flow with secure Stripe Connect integration, comprehensive expense management with receipt approval, and bilingual support using manual toggles (English/Spanish)." These version-specific constraints must be strictly followed.

## App Flow Integration

*   **Stack-Aligned Flow:**

    *   Example: "Next.js 14 Auth Flow → `app/auth/login/page.tsx` uses server actions for secure authentication and session management"

## Best Practices

*   **Next.js**

    *   Use Server and Client Components appropriately
    *   Leverage the App Router for nested and dynamic routes
    *   Avoid mixing App Router and Pages Router patterns

*   **Tailwind CSS**

    *   Utilize utility-first classes to maintain consistent styling
    *   Configure and use JIT mode for performance
    *   Adhere to responsive design principles across breakpoints

*   **Typescript**

    *   Enforce strict typing with proper interfaces and types
    *   Use modern ES features and module imports
    *   Run regular type checks during development

*   **Supabase**

    *   Secure API routes with proper authentication checks
    *   Use server functions for sensitive operations
    *   Maintain clear separation between client and server code

*   **Prisma**

    *   Optimize database queries and utilize transaction support
    *   Use schema migrations for database structure changes
    *   Implement connection pooling for efficient resource use

*   **Shadcn UI**

    *   Follow component-based design patterns for reusability
    *   Ensure components are accessible and responsive
    *   Use theming variables for dark/light mode consistency

*   **Clerk Auth**

    *   Integrate secure session management
    *   Enforce role-based access control
    *   Regularly update authentication protocols

*   **Stripe Connect**

    *   Handle both one-time and recurring donation flows robustly
    *   Implement secure payment processing and error handling
    *   Ensure digital receipts are generated and dispatched automatically

*   **React i18next**

    *   Configure manual language toggling for English and Spanish
    *   Use namespaces to organize translation files
    *   Ensure all UI text is translatable and contextually appropriate

*   **Twilio SMS API**

    *   Implement reliable SMS sending with error retries
    *   Maintain compliance with SMS consent tracking and privacy
    *   Log SMS events for auditing purposes

## Rules

*   Derive folder/file patterns **directly** from techStackDoc versions.
*   If Next.js 14 App Router: Enforce `app/` directory with nested route folders.
*   If Pages Router: Use `pages/*.tsx` flat structure.
*   Mirror this logic for React Router, SvelteKit, etc.
*   Never mix version patterns (e.g., no `pages/` in App Router projects).

## Rules Metrics

Before starting the project development, create a metrics file in the root of the project called

`cursor_metrics.md`.

### Instructions:

*   Each time a cursor rule is used as context, update `cursor_metrics.md`.
*   Use the following format for `cursor_metrics.md:`

# Rules Metrics

## Usage

The number of times rules is used as context

*   rule-name.mdc: 5
*   another-rule.mdc: 2
*   ...other rules
